{% extends '../messagesBase.html' %}
{% block entity %}
{% load static %}

<h2>Data import from Notoria</h2>

<form method="post">
    {% csrf_token %}
    <div class="col-sm-4 col-xs-4">
        <fieldset class="border m-3 p-2">
            <legend class="form-legend">{{form.bs_sheet}}</legend>
            {{form.chosen_sheets_bs}}
        </fieldset>
        <fieldset class="border m-3 p-2">
            <legend class="form-legend">{{form.fr_sheet}}</legend>
            {{form.chosen_sheets_fr}}
        </fieldset>
        <fieldset class="border m-3 p-2">
            <legend class="form-legend">{{form.dp_sheet}}</legend>
            {{form.chosen_sheets_dp}}
        </fieldset>
        <div class="form-group m-3 form-checkbox">
            {{form.directory_import}}
            <label for="id_directory_import">{{form.directory_import.label}}</label>
        </div>
        <div id="directory_choices" class="form-group m-3" style="display: none">
            {{form.override_save}}
        </div>
        <div class="form-group m-3">
            <label id="source_path" for="file_path">File path</label>
            <input class="form-control" id="file_path" type="text" name="file_path" value="{{ file_path }}">
        </div>
        <div class="form-group float-md-right submit-button">
            <input class="btn btn-dark" type="submit" value="Import">
        </div>
    </div>
</form>
<div id="pop-up-bs" class="modal fade" role="dialog">
    {% if error_bs %}
        <div id="bs_overlapping">
            {% include "import/overlapping_notoria_details.html" with error=error_bs sheet='bs' overlap=overlap_bs %}
        </div>
    {% endif %}
</div>
<div id="pop-up-fr" class="modal fade" role="dialog">
    {% if error_fr %}
        <div id="fr_overlapping">
            {% include "import/overlapping_notoria_details.html" with error=error_fr sheet='fr' overlap=overlap_fr %}
        </div>
    {% endif %}
</div>
<div id="pop-up-dp" class="modal fade" role="dialog">
    {% if error_dp %}
         <div id="dp_overlapping">
            {% include "import/overlapping_notoria_details.html" with error=error_dp sheet='dp' overlap=overlap_dp %}
         </div>
    {% endif %}
</div>
<div id="unification-modal" class="modal fade" role="dialog">
    {% if unification_form %}
    {% include "import/company_unification_details.html" %}
    {% endif %}
</div>
<script>
    $("#id_directory_import").change(function () {
        if ($(this).is(":checked")) {
            $("#directory_choices").show();
            $("#source_path").html("Directory path");
        } else {
            $("#directory_choices").hide();
            $("#source_path").html("File path");
        }
    })
    let errors_number = ($("#bs_overlapping").length === 0 ? 0 : 1 )
        + ($("#fr_overlapping").length === 0 ? 0 : 1 )
        + ($("#dp_overlapping").length === 0 ? 0 : 1 );
</script>
{{ form.errors }}
{{ form.non_field_errors }}
{% endblock %}
